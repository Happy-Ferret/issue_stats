%h2
  = link_to "https://github.com/#{@github_key}", class: "plain-link", target: "_blank" do
    = fa_icon "github", text: @github_key
  - if @report.ready?
    %small
      = @report.language

    .pull-right
      = render partial: "badge_modal", locals: {report: @report, variant: "pr"}
      = render partial: "badge_modal", locals: {report: @report, variant: "issue"}
    %br
    %br
    %p.small= @report.description

%br

- if @report.ready?
  = response_distribution_chart @report

- else
  = debug @report if Rails.env.development?
  %h1.text-center Hang Tight!
  %p.text-center.text-warning We're fetching some data for this repository. Check back in a minute or two.

%br
%br

.row.text-center
  .col-md-2.col-md-offset-1
    %h1
      = @report.issues_count
      .small
        %small
          = fa_icon "exclamation"
          closed issues
  .col-md-2
    %h1
      = @report.open_issues_count
      .small
        %small
          = fa_icon "exclamation-triangle"
          open issues
  .col-md-2
    %h1
      = @report.forks
      .small
        %small
          = fa_icon "code-fork"
          forks
  .col-md-2
    %h1
      = @report.stars
      .small
        %small
          = fa_icon :star
          stars
  .col-md-2
    %h1
      = number_to_human_size @report.bytes
      .small
        %small
          repository size


%br
%br

#markdown-container.well
  .text-center
    %h1
      = fa_icon "refresh", text: "Fetching README", class: "fa-spin"

.text-center
  - if @report.last_enqueued_at
    %small
      = fa_icon "refresh", class: 'fa-spin'
      %span.text-warning
        Enqueued to be updated
        = time_ago_in_words @report.last_enqueued_at
        ago
      = fa_icon "refresh", class: 'fa-spin'
  - else
    %small
      Updated
      = time_ago_in_words @report.updated_at
      ago
    %br
    = link_to report_path(@report), method: :put, remote: true, id: "refresh-report" do
      = fa_icon "refresh"
      %span#refresh-text refresh

:javascript
  fetchReadme(#{raw @report.to_json})